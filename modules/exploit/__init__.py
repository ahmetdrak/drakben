# modules/exploit/__init__.py
"""
DRAKBEN Exploit Package — Modular Vulnerability Testing Suite.

Architecture:
    common.py          — Shared classes, preconditions, retry logic, AI engines
    injection.py       — SQL, NoSQL, LDAP, Command injection
    auth_bypass.py     — JWT manipulation, session attacks, default creds
    header_security.py — HTTP headers, CORS, CSP, clickjacking
    file_inclusion.py  — LFI, RFI, file upload bypass, log poisoning

Sub-modules by vulnerability type (re-exported via this __init__):
    SQLi  : run_sqlmap, test_sqli_error_based, test_sqli_time_based
    XSS   : test_xss
    LFI   : test_lfi, test_lfi_advanced, test_rfi, test_log_poisoning
    XXE   : test_xxe
    SSRF  : test_ssrf
    CSRF  : test_csrf
    SSTI  : test_ssti
    IDOR  : test_idor
    Deser : test_deserialization
    Auth  : brute_force_login, test_default_credentials
    JWT   : JWTAnalyzer
    CORS  : test_cors_misconfiguration
    CSP   : analyze_csp
    NoSQL : test_nosql_injection
    LDAP  : test_ldap_injection
    CmdI  : test_command_injection
    Headers: audit_security_headers
    Upload: generate_upload_payloads
    AI    : suggest_exploit, ai_exploit_advice, fetch_and_prepare_exploit
"""

# Re-export the full public API from the common module
from modules.exploit.common import (
    STATE_AVAILABLE,
    AIEvasion,
    ExploitError,
    PolyglotEngine,
    RetryConfig,
    ai_exploit_advice,
    brute_force_login,
    check_exploit_preconditions,
    fetch_and_prepare_exploit,
    retry_on_failure,
    run_sqlmap,
    suggest_exploit,
    test_csrf,
    test_deserialization,
    test_idor,
    test_lfi,
    test_ssrf,
    test_ssti,
    test_xss,
    test_xxe,
)

# Conditional re-exports for test patching compatibility
try:
    from core.agent.state import AttackPhase  # noqa: F401
except ImportError:
    pass

# ── New exploit sub-modules ──
from modules.exploit.auth_bypass import (
    JWTAnalyzer,
    test_default_credentials,
    test_horizontal_privilege_escalation,
    test_session_fixation,
)
from modules.exploit.file_inclusion import (
    generate_upload_payloads,
    test_lfi_advanced,
    test_log_poisoning,
    test_rfi,
)
from modules.exploit.header_security import (
    analyze_csp,
    audit_security_headers,
    test_clickjacking,
    test_cors_misconfiguration,
    test_host_header_injection,
)
from modules.exploit.injection import (
    detect_dbms_from_error,
    generate_error_payloads,
    generate_union_probes,
    test_command_injection,
    test_ldap_injection,
    test_nosql_injection,
    test_sqli_error_based,
    test_sqli_time_based,
)

__all__ = [  # noqa: RUF022
    # Constants
    "STATE_AVAILABLE",
    "AIEvasion",
    # Classes
    "ExploitError",
    "PolyglotEngine",
    "RetryConfig",
    # AI / Suggest
    "ai_exploit_advice",
    # Auth
    "brute_force_login",
    "check_exploit_preconditions",
    "fetch_and_prepare_exploit",
    # Decorators / Helpers
    "retry_on_failure",
    # SQLi
    "run_sqlmap",
    "suggest_exploit",
    # CSRF
    "test_csrf",
    # Deserialization
    "test_deserialization",
    # IDOR
    "test_idor",
    # LFI
    "test_lfi",
    # SSRF
    "test_ssrf",
    # SSTI
    "test_ssti",
    # XSS
    "test_xss",
    # XXE
    "test_xxe",
    # ── New exploit sub-modules ──
    # Injection (SQL, NoSQL, LDAP, Command)
    "detect_dbms_from_error",
    "generate_error_payloads",
    "generate_union_probes",
    "test_sqli_error_based",
    "test_sqli_time_based",
    "test_nosql_injection",
    "test_ldap_injection",
    "test_command_injection",
    # Auth Bypass (JWT, Session, Credentials, PrivEsc)
    "JWTAnalyzer",
    "test_session_fixation",
    "test_default_credentials",
    "test_horizontal_privilege_escalation",
    # Header Security (CORS, CSP, Clickjacking, Host)
    "audit_security_headers",
    "test_cors_misconfiguration",
    "analyze_csp",
    "test_host_header_injection",
    "test_clickjacking",
    # File Inclusion (LFI advanced, RFI, Upload, Log poison)
    "test_lfi_advanced",
    "test_rfi",
    "generate_upload_payloads",
    "test_log_poisoning",
]
